@section scripts
{
    @Scripts.Render("~/bundles/Announcement")
}

<div id="ExceptionController" ng-controller="AnnouncementController">
    <div class="container-fluid">
        <div class="row" style="padding-bottom: 10px; padding-top: 10px">
            <div class="col-md-5">
                <span grid-filter-for="Announcements" place-holder-message="Tìm kiếm"></span>
            </div>
            <div class="col-md-5 pull-right text-right">
                <button class="btn btn-success btn-primary" data-toggle="modal"
                        data-target="#annoucementModal"
                        ng-if="AnnouncementFormConfig._CanCreate">
                    <i class="fa fa-file-sound-o white"></i>
                    <span>Thông báo</span>
                </button>
            </div>
        </div>
        <div class="row">
            <div class="col-md-12">
                <table grid-data="Announcements"
                       grid-data-type="table" @*table/storedprocedure*@
                       grid-data-action="get" @*get/getall*@
                       grid-data-object="T_Trans_Announcement_Store" @*table name or stored procedure name*@
                       grid-filter-condition="[StoreId] = {{CurrentStore}}"
                       @*must have [fieldname] for each colum field*@
                       grid-sort-condition="[AnnouncementId.CreatedDate] DESC" @*must have [fieldname] for each colum field*@
                       class="table table-striped table-bordered">
                    <thead>
                        <tr>
                            <th grid-defined-colum="AnnouncementId.Title"><span>Tiêu đề</span></th>
                            <th grid-defined-colum="AnnouncementId.Body"><span>Nội dung</span></th>
                            <th grid-defined-colum="AnnouncementId.CreatedBy.UserName, CreatedBy"><span>Tạo bởi</span></th>
                            <th grid-defined-colum="AnnouncementId.CreatedDate"><span>Ngày tạo</span></th>
                            <th></th>
                            <th class="none-display" grid-defined-colum="AnnouncementId"></th>
                            <th class="none-display" grid-defined-colum="AnnouncementId.StoreId"></th>
                            <th class="none-display" grid-defined-colum="AnnouncementId.Version,AnnounceVersion"></th>
                        </tr>
                    </thead>
                    <tbody>
                        @*Dataset must have grid id*@
                        <tr ng-repeat="item in DataSet.Announcements.Data">
                            <td ng-bind="item.Title"></td>
                            <td ng-init="item.HtmlBody = ConvertTrustHtml(item.Body)">
                                <span ng-bind-html="item.HtmlBody"> </span>
                            </td>
                            <td ng-bind="item.CreatedBy"></td>
                            <td ng-bind="item.CreatedDate"></td>
                            <td>
                                <a href="#" data-toggle="modal"
                                   data-target="#annoucementModal"
                                   ng-click="EditAnnouncement(item)"
                                   ng-if="item._CanUpdate">
                                    <i class="fa fa-edit"></i>
                                </a>
                            </td>
                        </tr>
                        <tr ng-if="!DataSet.Announcements.HasRecord()">
                            @*Edit colspan*@
                            <td colspan="5" align="center"> Không có dữ liệu! </td>
                        </tr>
                    </tbody>
                </table>
                <div class="row">
                    <div class="col-md-9 pull-left">
                        <span grid-paging-for="Announcements"></span>
                    </div>

                    <div class="col-md-3 pull-right">
                        <span grid-page-size-for="Announcements"></span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="annoucementModal" class="modal fade " role="dialog">
        <div class="modal-dialog modal-lg">
            <!-- Modal content-->
            <div class="modal-content">
                <div class="modal-header infobox-blue white border-6">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h4 class="modal-title">Thông báo </h4>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="form-group col-md-12">
                            <label class="col-sm-2 control-label ">Cửa hàng </label>
                            <div class="col-sm-4">
                                <select class="form-control" ng-model="AnnouncementForm.StoreId" dropdown-master-table="T_Master_Stores" dropdown-value-field="StoreId"
                                        dropdown-name-field="StoreName" dropdown-empty-text="Tất cả cửa hàng" dropdown-empty-value="0"
                                        check-under="check-announce"></select>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="form-group col-md-12">
                            <label class="col-sm-2 control-label ">Tiêu đề </label>
                            <div class="col-sm-10">
                                <input class="form-control" ng-model="AnnouncementForm.Title"
                                       check-empty="" check-empty-message="Vui lòng nhập tiêu đề."
                                       check-length="200" check-length-message="Chiều dài tối ta là {0}."
                                       check-under="check-announce" />
                            </div>
                        </div>
                    </div>
                    <div class="row" ng-init="InitEditor()">
                        <div class="form-group col-md-12">
                            <label class="col-sm-2 control-label ">Nội dung </label>
                            <div class="col-sm-10">
                                <textarea id="editor" class="form-control"></textarea>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">
                        <i class="fa-undo fa"></i>
                        Trở về
                    </button>
                    <button type="button" class="btn btn-primary" ng-click="SaveAnnouncementForm()">
                        <i class="fa-save fa"></i>
                        Lưu
                    </button>
                </div>
            </div>

        </div>
    </div>
</div>